<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>OpenTelemetry IE11 Complete Test Suite</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f5f5f5;
        line-height: 1.6;
      }

      .container {
        background: white;
        padding: 30px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
      }

      .header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        text-align: center;
        margin: -30px -30px 30px -30px;
        padding: 30px;
        border-radius: 8px 8px 0 0;
      }

      .section {
        margin-bottom: 30px;
        padding: 20px;
        border: 1px solid #ddd;
        border-radius: 6px;
        background-color: #fafafa;
      }

      .section h3 {
        margin-top: 0;
        color: #333;
        border-bottom: 2px solid #667eea;
        padding-bottom: 10px;
      }

      .button {
        background-color: #667eea;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 4px;
        cursor: pointer;
        margin: 5px;
        font-size: 14px;
        transition: background-color 0.3s;
      }

      .button:hover {
        background-color: #5a6fd8;
      }

      .button:disabled {
        background-color: #ccc;
        cursor: not-allowed;
      }

      .button.success {
        background-color: #28a745;
      }

      .button.error {
        background-color: #dc3545;
      }

      .button.warning {
        background-color: #ffc107;
        color: #212529;
      }

      .log-output {
        background-color: #2d3748;
        color: #68d391;
        padding: 15px;
        border-radius: 4px;
        font-family: "Courier New", monospace;
        font-size: 12px;
        max-height: 300px;
        overflow-y: auto;
        white-space: pre-wrap;
        border: 1px solid #4a5568;
      }

      .status-display {
        display: inline-block;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: bold;
      }

      .status-success {
        background-color: #d4edda;
        color: #155724;
      }

      .status-error {
        background-color: #f8d7da;
        color: #721c24;
      }

      .status-warning {
        background-color: #fff3cd;
        color: #856404;
      }

      .status-info {
        background-color: #d1ecf1;
        color: #0c5460;
      }

      .controls {
        text-align: center;
        margin: 20px 0;
      }

      .info-grid {
        display: table;
        width: 100%;
        border-collapse: collapse;
      }

      .info-row {
        display: table-row;
      }

      .info-label,
      .info-value {
        display: table-cell;
        padding: 8px 12px;
        border-bottom: 1px solid #eee;
      }

      .info-label {
        font-weight: bold;
        background-color: #f8f9fa;
        width: 200px;
      }

      .two-column {
        display: flex;
        gap: 20px;
        flex-wrap: wrap;
      }

      .column {
        flex: 1;
        min-width: 300px;
      }

      .event-area {
        border: 2px solid #ccc;
        padding: 20px;
        margin: 20px 0;
        background-color: #f9f9f9;
        cursor: pointer;
        border-radius: 6px;
        transition: background-color 0.3s;
      }

      .event-area:hover {
        background-color: #e9e9e9;
      }

      input[type="text"],
      input[type="url"] {
        padding: 8px;
        margin: 5px;
        border: 1px solid #ccc;
        border-radius: 4px;
        width: 300px;
      }

      .result {
        padding: 10px;
        margin: 10px 0;
        border-radius: 4px;
      }

      .result.success {
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }

      .result.error {
        background-color: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }

      .result.info {
        background-color: #d1ecf1;
        color: #0c5460;
        border: 1px solid #bee5eb;
      }

      pre {
        background-color: #f8f9fa;
        padding: 10px;
        border-radius: 4px;
        overflow-x: auto;
        font-size: 11px;
      }

      .tabs {
        display: flex;
        border-bottom: 2px solid #667eea;
        margin-bottom: 20px;
      }

      .tab {
        padding: 10px 20px;
        cursor: pointer;
        background-color: #f8f9fa;
        border: 1px solid #ddd;
        border-bottom: none;
        margin-right: 5px;
        border-radius: 6px 6px 0 0;
      }

      .tab.active {
        background-color: #667eea;
        color: white;
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
      }

      .collector-config {
        background-color: #fff3cd;
        padding: 15px;
        border-radius: 5px;
        margin-bottom: 20px;
        border: 1px solid #ffeaa7;
      }

      .trace-status {
        background-color: #e2e3e5;
        padding: 10px;
        border-radius: 4px;
        margin: 10px 0;
        font-family: monospace;
        font-size: 12px;
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin: 20px 0;
      }

      .stat-card {
        background: white;
        padding: 15px;
        border-radius: 6px;
        border: 1px solid #ddd;
        text-align: center;
      }

      .stat-value {
        font-size: 24px;
        font-weight: bold;
        color: #667eea;
      }

      .stat-label {
        font-size: 12px;
        color: #666;
        margin-top: 5px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>ğŸš€ OpenTelemetry IE11 Complete Test Suite</h1>
        <p>Agent í…ŒìŠ¤íŠ¸, DOM ì´ë²¤íŠ¸ ê³„ì¸¡, íŠ¸ë ˆì´ìŠ¤ ìˆ˜ì§‘ ë° ë‚´ë³´ë‚´ê¸°</p>
      </div>

      <!-- Navigation Tabs -->
      <div class="tabs">
        <div class="tab active" data-tab="agent-test">ğŸ” Agent í…ŒìŠ¤íŠ¸</div>
        <div class="tab" data-tab="dom-events">ğŸ¯ DOM ì´ë²¤íŠ¸</div>
        <div class="tab" data-tab="data-collection">ğŸ“Š ë°ì´í„° ìˆ˜ì§‘</div>
        <div class="tab" data-tab="trace-export">ğŸ“¤ íŠ¸ë ˆì´ìŠ¤ ë‚´ë³´ë‚´ê¸°</div>
      </div>

      <!-- Agent Test Tab -->
      <div id="agent-test" class="tab-content active">
        <div class="section">
          <h3>ğŸ” Agent ë¡œë”© ë° ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸</h3>
          <div class="controls">
            <button
              class="button"
              onclick="console.log('Button clicked!'); runAgentTests();"
            >
              ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
            </button>
            <button
              class="button"
              onclick="console.log('Clear clicked!'); clearAgentResults();"
            >
              ê²°ê³¼ ì§€ìš°ê¸°
            </button>
          </div>
          <div id="agent-results"></div>
        </div>

        <div class="section">
          <h3>ğŸ“‹ Agent ì •ë³´</h3>
          <div class="info-grid" id="agent-info">
            <div class="info-row">
              <div class="info-label">ë¡œë”© ìƒíƒœ</div>
              <div class="info-value" id="agent-loading-status">í™•ì¸ ì¤‘...</div>
            </div>
          </div>
        </div>
      </div>

      <!-- DOM Events Tab -->
      <div id="dom-events" class="tab-content">
        <div class="section">
          <h3>ğŸ¯ DOM ì´ë²¤íŠ¸ ê³„ì¸¡</h3>

          <!-- Collector Configuration -->
          <div class="collector-config">
            <h4>Collector ì„¤ì •</h4>
            <div class="info-grid">
              <div class="info-row">
                <div class="info-label">Trace Collector URL</div>
                <div class="info-value">
                  <input
                    type="url"
                    id="traceCollectorUrl"
                    value="http://localhost:4318/v1/traces"
                    style="width: 300px"
                  />
                </div>
              </div>
              <div class="info-row">
                <div class="info-label">Log Collector URL</div>
                <div class="info-value">
                  <input
                    type="url"
                    id="logCollectorUrl"
                    value="http://localhost:4318/v1/logs"
                    style="width: 300px"
                  />
                </div>
              </div>
              <div class="info-row">
                <div class="info-label">Metric Collector URL</div>
                <div class="info-value">
                  <input
                    type="url"
                    id="metricCollectorUrl"
                    value="http://localhost:4318/v1/metrics"
                    style="width: 300px"
                  />
                </div>
              </div>
            </div>

            <div class="controls">
              <button class="button" onclick="testAllCollectorConnections()">
                ëª¨ë“  Collector ì—°ê²° í…ŒìŠ¤íŠ¸
              </button>
              <button class="button" onclick="sendTestTrace()">
                í…ŒìŠ¤íŠ¸ íŠ¸ë ˆì´ìŠ¤ ì „ì†¡
              </button>
              <button class="button" onclick="sendTestLog()">
                í…ŒìŠ¤íŠ¸ ë¡œê·¸ ì „ì†¡
              </button>
              <button class="button" onclick="sendTestMetric()">
                í…ŒìŠ¤íŠ¸ ë©”íŠ¸ë¦­ ì „ì†¡
              </button>
            </div>

            <div class="trace-status" id="collectorStatus">
              Ready to send telemetry data
            </div>
          </div>

          <div class="controls">
            <button class="button" onclick="startInstrumentation()">
              ê³„ì¸¡ ì‹œì‘
            </button>
            <button class="button" onclick="stopInstrumentation()">
              ê³„ì¸¡ ì¤‘ì§€
            </button>
            <button class="button" onclick="clearEventLogs()">
              ë¡œê·¸ ì§€ìš°ê¸°
            </button>
            <button class="button" onclick="exportEventLogs()">
              ë¡œê·¸ ë‚´ë³´ë‚´ê¸°
            </button>
            <button class="button" onclick="flushTraces()">
              íŠ¸ë ˆì´ìŠ¤ Flush
            </button>
          </div>

          <div class="controls">
            <label>ì´ë²¤íŠ¸ í•„í„°: </label>
            <input
              type="text"
              id="eventFilter"
              placeholder="ì˜ˆ: click,keydown,submit"
              value="click,dblclick,keydown,submit,mouseover,mouseout"
            />
            <button class="button" onclick="updateEventFilter()">
              í•„í„° ì ìš©
            </button>
          </div>

          <div class="two-column">
            <div class="column">
              <!-- Event Test Areas -->
              <div
                class="event-area"
                onclick="handleAreaClick(event)"
                ondblclick="handleAreaDblClick(event)"
                onmouseover="handleAreaMouseOver(event)"
                onmouseout="handleAreaMouseOut(event)"
              >
                <h4>í´ë¦­ í…ŒìŠ¤íŠ¸ ì˜ì—­</h4>
                <p>
                  ì´ ì˜ì—­ì„ í´ë¦­, ë”ë¸”í´ë¦­, ë§ˆìš°ìŠ¤ ì˜¤ë²„í•˜ì—¬ ì´ë²¤íŠ¸ë¥¼ ìƒì„±í•˜ì„¸ìš”.
                </p>
              </div>

              <div class="controls">
                <input
                  type="text"
                  id="textInput"
                  placeholder="í‚¤ë³´ë“œ ì´ë²¤íŠ¸ ìƒì„±ìš©"
                  onkeydown="handleKeyDown(event)"
                />
                <button class="button" onclick="submitForm()">í¼ ì œì¶œ</button>
              </div>

              <form onsubmit="handleFormSubmit(event)">
                <input type="text" placeholder="í¼ ì…ë ¥" name="formInput" />
                <input type="submit" value="í¼ìœ¼ë¡œ ì œì¶œ" class="button" />
              </form>

              <!-- Event Statistics -->
              <div class="stats-grid">
                <div class="stat-card">
                  <div class="stat-value" id="totalEvents">0</div>
                  <div class="stat-label">ì´ ì´ë²¤íŠ¸</div>
                </div>
                <div class="stat-card">
                  <div class="stat-value" id="uniqueTypes">0</div>
                  <div class="stat-label">ê³ ìœ  íƒ€ì…</div>
                </div>
                <div class="stat-card">
                  <div class="stat-value" id="tracesSent">0</div>
                  <div class="stat-label">ì „ì†¡ëœ íŠ¸ë ˆì´ìŠ¤</div>
                </div>
                <div class="stat-card">
                  <div class="stat-value" id="tracesFailed">0</div>
                  <div class="stat-label">ì‹¤íŒ¨í•œ íŠ¸ë ˆì´ìŠ¤</div>
                </div>
              </div>
            </div>

            <div class="column">
              <h4>ì´ë²¤íŠ¸ ë¡œê·¸</h4>
              <div class="log-output" id="eventLogArea"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Data Collection Tab -->
      <div id="data-collection" class="tab-content">
        <div class="section">
          <h3>ğŸ“Š ë°ì´í„° ìˆ˜ì§‘ ë° ê´€ë¦¬</h3>

          <div class="controls">
            <button class="button" onclick="startDataCollection()">
              ë°ì´í„° ìˆ˜ì§‘ ì‹œì‘
            </button>
            <button class="button" onclick="stopDataCollection()">
              ë°ì´í„° ìˆ˜ì§‘ ì¤‘ì§€
            </button>
            <button class="button" onclick="generateTestData()">
              í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„±
            </button>
            <button class="button" onclick="clearCollectedData()">
              ìˆ˜ì§‘ ë°ì´í„° ì§€ìš°ê¸°
            </button>
          </div>

          <div class="info-grid">
            <div class="info-row">
              <div class="info-label">ìˆ˜ì§‘ ìƒíƒœ</div>
              <div class="info-value" id="collection-status">
                <span class="status-display status-warning">ì¤‘ì§€ë¨</span>
              </div>
            </div>
            <div class="info-row">
              <div class="info-label">ìˆ˜ì§‘ëœ Span ìˆ˜</div>
              <div class="info-value" id="spans-collected">0</div>
            </div>
            <div class="info-row">
              <div class="info-label">ìˆ˜ì§‘ëœ ë©”íŠ¸ë¦­ ìˆ˜</div>
              <div class="info-value" id="metrics-collected">0</div>
            </div>
            <div class="info-row">
              <div class="info-label">ë§ˆì§€ë§‰ ìˆ˜ì§‘ ì‹œê°„</div>
              <div class="info-value" id="last-collection-time">-</div>
            </div>
          </div>

          <h4>ìˆ˜ì§‘ëœ ë°ì´í„°</h4>
          <div class="log-output" id="collected-data-log"></div>
        </div>
      </div>

      <!-- Trace Export Tab -->
      <div id="trace-export" class="tab-content">
        <div class="section">
          <h3>ğŸ“¤ íŠ¸ë ˆì´ìŠ¤ ë‚´ë³´ë‚´ê¸°</h3>

          <div class="collector-config">
            <h4>Collector ì„¤ì •</h4>
            <div class="info-grid">
              <div class="info-row">
                <div class="info-label">Collector URL</div>
                <div class="info-value" id="export-collector-url">
                  http://localhost:4318
                </div>
              </div>
              <div class="info-row">
                <div class="info-label">ë‚´ë³´ë‚´ê¸° í˜•ì‹</div>
                <div class="info-value">OTLP/HTTP (JSON)</div>
              </div>
              <div class="info-row">
                <div class="info-label">ì—°ê²° ìƒíƒœ</div>
                <div class="info-value" id="export-connection-status">
                  <span class="status-display status-warning">í…ŒìŠ¤íŠ¸ ì•ˆë¨</span>
                </div>
              </div>
            </div>

            <div class="controls">
              <button class="button" onclick="testExportConnection()">
                ì—°ê²° í…ŒìŠ¤íŠ¸
              </button>
              <button class="button" onclick="exportAllData()">
                ëª¨ë“  ë°ì´í„° ë‚´ë³´ë‚´ê¸°
              </button>
              <button class="button" onclick="exportSelectedData()">
                ì„ íƒ ë°ì´í„° ë‚´ë³´ë‚´ê¸°
              </button>
            </div>
          </div>

          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-value" id="export-total-spans">0</div>
              <div class="stat-label">ë‚´ë³´ë‚¼ Span ìˆ˜</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="export-success-count">0</div>
              <div class="stat-label">ì„±ê³µí•œ ë‚´ë³´ë‚´ê¸°</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="export-failed-count">0</div>
              <div class="stat-label">ì‹¤íŒ¨í•œ ë‚´ë³´ë‚´ê¸°</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="export-last-time">-</div>
              <div class="stat-label">ë§ˆì§€ë§‰ ë‚´ë³´ë‚´ê¸°</div>
            </div>
          </div>

          <h4>ë‚´ë³´ë‚´ê¸° ë¡œê·¸</h4>
          <div class="log-output" id="export-log"></div>
        </div>
      </div>
    </div>

    <!-- Load the agent -->
    <script src="/agent.js?v=1"></script>

    <script>
      // Define all functions first to avoid reference errors

      // Global variables
      var currentTab = "agent-test";
      var instrumentation = null;
      var isInstrumentationActive = false;
      var eventHistory = [];
      var collectedData = [];
      var isDataCollectionActive = false;
      var tracesSent = 0;
      var tracesFailed = 0;
      var pendingSpans = [];
      var traceId = null;
      var exportSuccessCount = 0;
      var exportFailedCount = 0;

      // Tab Management
      function showTab(tabName) {
        console.log("showTab called with:", tabName);

        // Hide all tab contents
        var contents = document.querySelectorAll(".tab-content");
        console.log("Found tab contents:", contents.length);
        for (var i = 0; i < contents.length; i++) {
          contents[i].classList.remove("active");
        }

        // Remove active class from all tabs
        var tabs = document.querySelectorAll(".tab");
        for (var i = 0; i < tabs.length; i++) {
          tabs[i].classList.remove("active");
        }

        // Show selected tab content
        var targetTab = document.getElementById(tabName);
        console.log("Target tab element:", targetTab);
        if (targetTab) {
          targetTab.classList.add("active");
        }

        // Find and activate the corresponding tab
        var tabElements = document.querySelectorAll(".tab");
        for (var i = 0; i < tabElements.length; i++) {
          var dataTab = tabElements[i].getAttribute("data-tab");
          if (dataTab === tabName) {
            tabElements[i].classList.add("active");
            console.log("Activated tab:", dataTab);
            break;
          }
        }

        currentTab = tabName;
      }

      // Agent Test Functions
      function runAgentTests() {
        var resultsContainer = document.getElementById("agent-results");
        resultsContainer.innerHTML = "";

        addResult("agent-results", "ğŸ” Agent í…ŒìŠ¤íŠ¸ ì‹œì‘...", "info");

        // Test 1: Check if agent is loaded
        if (typeof OpenTelemetryIE11Agent !== "undefined") {
          addResult(
            "agent-results",
            "âœ… OpenTelemetryIE11Agent ë¡œë“œë¨",
            "success"
          );

          try {
            var agent = OpenTelemetryIE11Agent;
            var info = {
              agentVersion: agent.agentVersion,
              buildType: agent.buildType,
              ie11Compatible: agent.ie11Compatible,
              VERSION: agent.VERSION,
              hasTrace: typeof agent.trace !== "undefined",
              hasMetrics: typeof agent.metrics !== "undefined",
              hasContext: typeof agent.context !== "undefined",
              hasCore: typeof agent.core !== "undefined",
              isIE11Function: typeof agent.isIE11 === "function",
            };

            addResult(
              "agent-results",
              "âœ… Agent ì†ì„±: <pre>" + JSON.stringify(info, null, 2) + "</pre>",
              "success"
            );

            // Update agent info display
            updateAgentInfo(agent);

            // Test isIE11 function
            if (typeof agent.isIE11 === "function") {
              var isIE11Result = agent.isIE11();
              addResult(
                "agent-results",
                "âœ… isIE11() ê²°ê³¼: " + isIE11Result,
                "info"
              );
            }

            // Test core utilities
            if (agent.core) {
              testCoreUtilities(agent.core);
            }

            // Test global aliases
            testGlobalAliases();
          } catch (error) {
            addResult(
              "agent-results",
              "âŒ Agent ì†ì„± í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜: " + error.message,
              "error"
            );
          }
        } else {
          addResult(
            "agent-results",
            "âŒ OpenTelemetryIE11Agent ë¡œë“œë˜ì§€ ì•ŠìŒ",
            "error"
          );
          testGlobalAliases();
        }
      }

      function clearAgentResults() {
        document.getElementById("agent-results").innerHTML = "";
      }

      // Utility Functions
      function addResult(containerId, message, type) {
        var container = document.getElementById(containerId);
        var div = document.createElement("div");
        div.className = "result " + type;
        div.innerHTML = message;
        container.appendChild(div);
      }

      function addLogEntry(containerId, message, type) {
        var container = document.getElementById(containerId);
        var timestamp = new Date().toLocaleTimeString();
        var entry = "[" + timestamp + "] " + message + "\n";
        container.textContent += entry;
        container.scrollTop = container.scrollHeight;
      }

      // Placeholder functions for other buttons (will be implemented)
      function testAllCollectorConnections() {
        console.log("testAllCollectorConnections called");
      }
      function sendTestTrace() {
        console.log("sendTestTrace called");
      }
      function sendTestLog() {
        console.log("sendTestLog called");
      }
      function sendTestMetric() {
        console.log("sendTestMetric called");
      }
      function startInstrumentation() {
        console.log("startInstrumentation called");
      }
      function stopInstrumentation() {
        console.log("stopInstrumentation called");
      }
      function clearEventLogs() {
        console.log("clearEventLogs called");
      }
      function exportEventLogs() {
        console.log("exportEventLogs called");
      }
      function flushTraces() {
        console.log("flushTraces called");
      }
      function updateEventFilter() {
        console.log("updateEventFilter called");
      }
      function handleAreaClick(event) {
        console.log("handleAreaClick called");
      }
      function submitForm() {
        console.log("submitForm called");
      }
      function startDataCollection() {
        console.log("startDataCollection called");
      }
      function stopDataCollection() {
        console.log("stopDataCollection called");
      }
      function generateTestData() {
        console.log("generateTestData called");
      }
      function clearCollectedData() {
        console.log("clearCollectedData called");
      }
      function testExportConnection() {
        console.log("testExportConnection called");
      }
      function exportAllData() {
        console.log("exportAllData called");
      }
      function exportSelectedData() {
        console.log("exportSelectedData called");
      }
      function updateAgentInfo(agent) {
        console.log("updateAgentInfo called");
      }
      function testCoreUtilities(core) {
        console.log("testCoreUtilities called");
      }
      function testGlobalAliases() {
        console.log("testGlobalAliases called");
      }
    </script>

    <script>
      // Initialize when DOM is ready

      // Utility Functions
      function generateTraceId() {
        var hex = "";
        for (var i = 0; i < 32; i++) {
          hex += Math.floor(Math.random() * 16).toString(16);
        }
        return hex;
      }

      function generateSpanId() {
        var hex = "";
        for (var i = 0; i < 16; i++) {
          hex += Math.floor(Math.random() * 16).toString(16);
        }
        return hex;
      }

      function getTimeNanos() {
        var now = Date.now();
        return now * 1000000;
      }

      function addLogEntry(containerId, message, type) {
        var container = document.getElementById(containerId);
        var timestamp = new Date().toLocaleTimeString();
        var entry = "[" + timestamp + "] " + message + "\n";
        container.textContent += entry;
        container.scrollTop = container.scrollHeight;
      }

      function addResult(containerId, message, type) {
        var container = document.getElementById(containerId);
        var div = document.createElement("div");
        div.className = "result " + type;
        div.innerHTML = message;
        container.appendChild(div);
      }

      // Agent Test Functions
      function runAgentTests() {
        var resultsContainer = document.getElementById("agent-results");
        resultsContainer.innerHTML = "";

        addResult("agent-results", "ğŸ” Agent í…ŒìŠ¤íŠ¸ ì‹œì‘...", "info");

        // Test 1: Check if agent is loaded
        if (typeof OpenTelemetryIE11Agent !== "undefined") {
          addResult(
            "agent-results",
            "âœ… OpenTelemetryIE11Agent ë¡œë“œë¨",
            "success"
          );

          try {
            var agent = OpenTelemetryIE11Agent;
            var info = {
              agentVersion: agent.agentVersion,
              buildType: agent.buildType,
              ie11Compatible: agent.ie11Compatible,
              VERSION: agent.VERSION,
              hasTrace: typeof agent.trace !== "undefined",
              hasMetrics: typeof agent.metrics !== "undefined",
              hasContext: typeof agent.context !== "undefined",
              hasCore: typeof agent.core !== "undefined",
              isIE11Function: typeof agent.isIE11 === "function",
            };

            addResult(
              "agent-results",
              "âœ… Agent ì†ì„±: <pre>" + JSON.stringify(info, null, 2) + "</pre>",
              "success"
            );

            // Update agent info display
            updateAgentInfo(agent);

            // Test isIE11 function
            if (typeof agent.isIE11 === "function") {
              var isIE11Result = agent.isIE11();
              addResult(
                "agent-results",
                "âœ… isIE11() ê²°ê³¼: " + isIE11Result,
                "info"
              );
            }

            // Test core utilities
            if (agent.core) {
              testCoreUtilities(agent.core);
            }

            // Test global aliases
            testGlobalAliases();
          } catch (error) {
            addResult(
              "agent-results",
              "âŒ Agent ì†ì„± í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜: " + error.message,
              "error"
            );
          }
        } else {
          addResult(
            "agent-results",
            "âŒ OpenTelemetryIE11Agent ë¡œë“œë˜ì§€ ì•ŠìŒ",
            "error"
          );
          testGlobalAliases();
        }
      }

      function updateAgentInfo(agent) {
        var infoContainer = document.getElementById("agent-info");
        infoContainer.innerHTML = `
          <div class="info-row">
            <div class="info-label">ë¡œë”© ìƒíƒœ</div>
            <div class="info-value"><span class="status-display status-success">ë¡œë“œë¨</span></div>
          </div>
          <div class="info-row">
            <div class="info-label">Agent ë²„ì „</div>
            <div class="info-value">${agent.agentVersion || "N/A"}</div>
          </div>
          <div class="info-row">
            <div class="info-label">ë¹Œë“œ íƒ€ì…</div>
            <div class="info-value">${agent.buildType || "N/A"}</div>
          </div>
          <div class="info-row">
            <div class="info-label">IE11 í˜¸í™˜</div>
            <div class="info-value">${agent.ie11Compatible || "N/A"}</div>
          </div>
          <div class="info-row">
            <div class="info-label">í˜„ì¬ ë¸Œë¼ìš°ì €</div>
            <div class="info-value">${
              agent.isIE11 ? agent.isIE11() : "Unknown"
            }</div>
          </div>
        `;
      }

      function testCoreUtilities(core) {
        var coreInfo = {
          hasObjectAssign: typeof core.objectAssign !== "undefined",
          hasHrTime: typeof core.hrTime !== "undefined",
          hasGetTimeOrigin: typeof core.getTimeOrigin !== "undefined",
        };
        addResult(
          "agent-results",
          "âœ… Core ìœ í‹¸ë¦¬í‹°: <pre>" +
            JSON.stringify(coreInfo, null, 2) +
            "</pre>",
          "info"
        );

        // Test hrTime function
        if (typeof core.hrTime === "function") {
          try {
            var hrTimeResult = core.hrTime();
            addResult(
              "agent-results",
              "âœ… hrTime() ê²°ê³¼: [" +
                hrTimeResult[0] +
                ", " +
                hrTimeResult[1] +
                "]",
              "info"
            );
          } catch (error) {
            addResult(
              "agent-results",
              "âŒ hrTime() ì˜¤ë¥˜: " + error.message,
              "error"
            );
          }
        }

        // Test getTimeOrigin function
        if (typeof core.getTimeOrigin === "function") {
          try {
            var timeOriginResult = core.getTimeOrigin();
            addResult(
              "agent-results",
              "âœ… getTimeOrigin() ê²°ê³¼: " + timeOriginResult,
              "info"
            );
          } catch (error) {
            addResult(
              "agent-results",
              "âŒ getTimeOrigin() ì˜¤ë¥˜: " + error.message,
              "error"
            );
          }
        }
      }

      function testGlobalAliases() {
        var aliases = [];
        if (typeof window.OpenTelemetryIE11 !== "undefined")
          aliases.push("OpenTelemetryIE11");
        if (typeof window.opentelemetry !== "undefined")
          aliases.push("opentelemetry");
        if (typeof window.OTelAgent !== "undefined") aliases.push("OTelAgent");

        if (aliases.length > 0) {
          addResult(
            "agent-results",
            "âœ… ì‚¬ìš© ê°€ëŠ¥í•œ ì „ì—­ ë³„ì¹­: " + aliases.join(", "),
            "info"
          );
        } else {
          addResult(
            "agent-results",
            "âŒ OpenTelemetry ì „ì—­ ê°ì²´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ",
            "error"
          );
        }
      }

      function clearAgentResults() {
        document.getElementById("agent-results").innerHTML = "";
      }

      // DOM Event Functions
      function startInstrumentation() {
        if (isInstrumentationActive) return;

        try {
          if (typeof OpenTelemetryIE11Agent !== "undefined") {
            instrumentation = createDOMEventInstrumentation({
              trackedEvents: getFilteredEvents(),
              enableTiming: true,
              maxEventHistory: 1000,
              throttleInterval: 16,
            });

            instrumentation.addHandler(logEvent);
            instrumentation.instrument(document);

            isInstrumentationActive = true;
            addLogEntry("eventLogArea", "âœ… DOM ì´ë²¤íŠ¸ ê³„ì¸¡ ì‹œì‘ë¨", "success");

            // Initialize trace ID
            if (!traceId) {
              traceId = generateTraceId();
              updateTraceStatus(
                "ìƒˆ íŠ¸ë ˆì´ìŠ¤ ì„¸ì…˜ ì‹œì‘: " + traceId.substring(0, 8) + "..."
              );
            }
          } else {
            throw new Error("OpenTelemetry Agentë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŒ");
          }
        } catch (error) {
          addLogEntry(
            "eventLogArea",
            "âŒ ê³„ì¸¡ ì‹œì‘ ì‹¤íŒ¨: " + error.message,
            "error"
          );
        }
      }

      function stopInstrumentation() {
        if (!isInstrumentationActive) return;

        try {
          flushTraces();

          if (instrumentation) {
            instrumentation.destroy();
            instrumentation = null;
          }

          isInstrumentationActive = false;
          addLogEntry("eventLogArea", "â¹ï¸ DOM ì´ë²¤íŠ¸ ê³„ì¸¡ ì¤‘ì§€ë¨", "info");
        } catch (error) {
          addLogEntry(
            "eventLogArea",
            "âŒ ê³„ì¸¡ ì¤‘ì§€ ì‹¤íŒ¨: " + error.message,
            "error"
          );
        }
      }

      function getFilteredEvents() {
        var filterInput = document.getElementById("eventFilter");
        var filterValue = filterInput.value.trim();

        if (!filterValue) {
          return [
            "click",
            "dblclick",
            "keydown",
            "submit",
            "mouseover",
            "mouseout",
          ];
        }

        return filterValue.split(",").map(function (event) {
          return event.trim();
        });
      }

      function updateEventFilter() {
        if (instrumentation && instrumentation.updateConfig) {
          try {
            instrumentation.updateConfig({
              trackedEvents: getFilteredEvents(),
            });
            addLogEntry("eventLogArea", "âœ… ì´ë²¤íŠ¸ í•„í„° ì—…ë°ì´íŠ¸ë¨", "info");
          } catch (error) {
            addLogEntry(
              "eventLogArea",
              "âŒ í•„í„° ì—…ë°ì´íŠ¸ ì‹¤íŒ¨: " + error.message,
              "error"
            );
          }
        }
      }

      function logEvent(eventData) {
        eventHistory.push(eventData);

        // Create OpenTelemetry span
        if (traceId) {
          try {
            var span = createSpan(eventData);
            pendingSpans.push(span);

            // Auto-flush every 10 spans
            if (pendingSpans.length >= 10) {
              sendTracesToCollector(pendingSpans.slice());
              pendingSpans = [];
            }
          } catch (error) {
            console.warn("Span ìƒì„± ì‹¤íŒ¨:", error);
          }
        }

        // Log to display
        var timestamp = new Date(eventData.timestamp).toLocaleTimeString();
        var duration = eventData.duration
          ? " (" + eventData.duration.toFixed(2) + "ms)"
          : "";
        var logMessage =
          "[" +
          eventData.type +
          "] " +
          eventData.target +
          " (" +
          eventData.phase +
          ")" +
          duration;

        addLogEntry("eventLogArea", logMessage, "info");
        updateEventStatistics();
      }

      function updateEventStatistics() {
        var eventTypes = {};
        var totalDuration = 0;
        var durationCount = 0;

        for (var i = 0; i < eventHistory.length; i++) {
          var event = eventHistory[i];
          var type = event.type;
          eventTypes[type] = (eventTypes[type] || 0) + 1;

          if (event.duration) {
            totalDuration += event.duration;
            durationCount++;
          }
        }

        var mostFrequent = "";
        var maxCount = 0;
        for (var type in eventTypes) {
          if (eventTypes.hasOwnProperty(type) && eventTypes[type] > maxCount) {
            mostFrequent = type;
            maxCount = eventTypes[type];
          }
        }

        document.getElementById("totalEvents").textContent =
          eventHistory.length;
        document.getElementById("uniqueTypes").textContent =
          Object.keys(eventTypes).length;
        document.getElementById("tracesSent").textContent = tracesSent;
        document.getElementById("tracesFailed").textContent = tracesFailed;
      }

      function clearEventLogs() {
        document.getElementById("eventLogArea").textContent = "";
        eventHistory = [];
        pendingSpans = [];
        updateEventStatistics();
      }

      function exportEventLogs() {
        if (eventHistory.length === 0) {
          alert("ë‚´ë³´ë‚¼ ì´ë²¤íŠ¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤");
          return;
        }

        var csvContent = "Timestamp,Type,Target,Phase,Duration\n";
        for (var i = 0; i < eventHistory.length; i++) {
          var event = eventHistory[i];
          csvContent +=
            event.timestamp +
            "," +
            event.type +
            "," +
            event.target +
            "," +
            event.phase +
            "," +
            (event.duration || "") +
            "\n";
        }

        var blob = new Blob([csvContent], { type: "text/csv" });
        var url = URL.createObjectURL(blob);
        var a = document.createElement("a");
        a.href = url;
        a.download =
          "dom-events-" + new Date().toISOString().slice(0, 10) + ".csv";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }

      // Trace Functions
      function createSpan(eventData, parentSpanId) {
        var spanId = generateSpanId();
        var startTime = getTimeNanos();
        var endTime =
          startTime +
          (eventData.duration ? eventData.duration * 1000000 : 1000000);

        return {
          traceId: traceId,
          spanId: spanId,
          parentSpanId: parentSpanId || "",
          name: "dom." + eventData.type,
          kind: 1,
          startTimeUnixNano: startTime.toString(),
          endTimeUnixNano: endTime.toString(),
          attributes: [
            { key: "event.type", value: { stringValue: eventData.type } },
            { key: "event.target", value: { stringValue: eventData.target } },
            { key: "event.phase", value: { stringValue: eventData.phase } },
            { key: "event.bubbled", value: { boolValue: eventData.bubbled } },
            {
              key: "event.cancelled",
              value: { boolValue: eventData.cancelled },
            },
            {
              key: "browser.userAgent",
              value: { stringValue: navigator.userAgent },
            },
          ],
          status: { code: 1 },
        };
      }

      function sendTracesToCollector(spans) {
        var collectorUrl = document.getElementById("traceCollectorUrl").value;

        if (!spans || spans.length === 0) {
          updateTraceStatus("ì „ì†¡í•  spanì´ ì—†ìŒ");
          return;
        }

        var payload = {
          resourceSpans: [
            {
              resource: {
                attributes: [
                  {
                    key: "service.name",
                    value: { stringValue: "dom-event-instrumentation" },
                  },
                  { key: "service.version", value: { stringValue: "1.0.0" } },
                  {
                    key: "telemetry.sdk.name",
                    value: { stringValue: "opentelemetry-js-ie11" },
                  },
                  {
                    key: "telemetry.sdk.version",
                    value: { stringValue: "1.0.0" },
                  },
                ],
              },
              scopeSpans: [
                {
                  scope: {
                    name: "dom-event-instrumentation",
                    version: "1.0.0",
                  },
                  spans: spans,
                },
              ],
            },
          ],
        };

        var collectorUrl = document.getElementById("traceCollectorUrl").value;
        updateCollectorStatus(
          spans.length + "ê°œ spanì„ trace collectorë¡œ ì „ì†¡ ì¤‘..."
        );

        var xhr = new XMLHttpRequest();
        xhr.open("POST", collectorUrl, true);
        xhr.setRequestHeader("Content-Type", "application/json");

        xhr.onreadystatechange = function () {
          if (xhr.readyState === 4) {
            if (xhr.status >= 200 && xhr.status < 300) {
              tracesSent += spans.length;
              updateCollectorStatus(
                "âœ… " + spans.length + "ê°œ trace ì „ì†¡ ì„±ê³µ"
              );
              updateEventStatistics();
            } else {
              tracesFailed += spans.length;
              updateCollectorStatus(
                "âŒ íŠ¸ë ˆì´ìŠ¤ ì „ì†¡ ì‹¤íŒ¨: " + xhr.status + " " + xhr.statusText
              );
              updateEventStatistics();
            }
          }
        };

        xhr.onerror = function () {
          tracesFailed += spans.length;
          updateCollectorStatus("âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ë¡œ íŠ¸ë ˆì´ìŠ¤ ì „ì†¡ ì‹¤íŒ¨");
          updateEventStatistics();
        };

        try {
          xhr.send(JSON.stringify(payload));
        } catch (error) {
          tracesFailed += spans.length;
          updateCollectorStatus("âŒ íŠ¸ë ˆì´ìŠ¤ ì „ì†¡ ì˜¤ë¥˜: " + error.message);
          updateEventStatistics();
        }
      }

      // Collector Connection Functions
      function testAllCollectorConnections() {
        updateCollectorStatus("ëª¨ë“  collector ì—°ê²° í…ŒìŠ¤íŠ¸ ì¤‘...");

        var traceUrl = document.getElementById("traceCollectorUrl").value;
        var logUrl = document.getElementById("logCollectorUrl").value;
        var metricUrl = document.getElementById("metricCollectorUrl").value;

        var results = [];
        var completed = 0;
        var total = 3;

        function checkComplete() {
          completed++;
          if (completed === total) {
            var successCount = results.filter(function (r) {
              return r.success;
            }).length;
            updateCollectorStatus(
              "âœ… " + successCount + "/" + total + " collector ì—°ê²° ì„±ê³µ"
            );
          }
        }

        // Test trace collector
        testCollectorConnection(traceUrl, "Trace", function (success) {
          results.push({ type: "trace", success: success });
          checkComplete();
        });

        // Test log collector
        testCollectorConnection(logUrl, "Log", function (success) {
          results.push({ type: "log", success: success });
          checkComplete();
        });

        // Test metric collector
        testCollectorConnection(metricUrl, "Metric", function (success) {
          results.push({ type: "metric", success: success });
          checkComplete();
        });
      }

      function testCollectorConnection(collectorUrl, type, callback) {
        var xhr = new XMLHttpRequest();
        xhr.open("POST", collectorUrl, true);
        xhr.setRequestHeader("Content-Type", "application/json");

        xhr.onreadystatechange = function () {
          if (xhr.readyState === 4) {
            if (xhr.status >= 200 && xhr.status < 300) {
              updateCollectorStatus("âœ… " + type + " Collector ì—°ê²° ì„±ê³µ");
              callback(true);
            } else {
              updateCollectorStatus(
                "âŒ " +
                  type +
                  " Collector ì—°ê²° ì‹¤íŒ¨: " +
                  xhr.status +
                  " " +
                  xhr.statusText
              );
              callback(false);
            }
          }
        };

        xhr.onerror = function () {
          updateCollectorStatus("âŒ " + type + " Collector ë„¤íŠ¸ì›Œí¬ ì—°ê²° ì˜¤ë¥˜");
          callback(false);
        };

        var testPayload = getTestPayload(type);
        try {
          xhr.send(JSON.stringify(testPayload));
        } catch (error) {
          updateCollectorStatus(
            "âŒ " + type + " ì—°ê²° í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜: " + error.message
          );
          callback(false);
        }
      }

      function getTestPayload(type) {
        switch (type.toLowerCase()) {
          case "trace":
            return { resourceSpans: [] };
          case "log":
            return { resourceLogs: [] };
          case "metric":
            return { resourceMetrics: [] };
          default:
            return {};
        }
      }

      // Test Data Sending Functions
      function sendTestTrace() {
        if (!traceId) {
          traceId = generateTraceId();
        }

        var testSpan = {
          traceId: traceId,
          spanId: generateSpanId(),
          parentSpanId: "",
          name: "test.trace.span",
          kind: 1,
          startTimeUnixNano: getTimeNanos().toString(),
          endTimeUnixNano: (getTimeNanos() + 1000000).toString(),
          attributes: [
            { key: "test.type", value: { stringValue: "trace_test" } },
            {
              key: "test.timestamp",
              value: { stringValue: new Date().toISOString() },
            },
          ],
          status: { code: 1 },
        };

        sendTracesToCollector([testSpan]);
      }

      function sendTestLog() {
        var logCollectorUrl = document.getElementById("logCollectorUrl").value;
        updateCollectorStatus("í…ŒìŠ¤íŠ¸ ë¡œê·¸ë¥¼ log collectorë¡œ ì „ì†¡ ì¤‘...");

        var logPayload = {
          resourceLogs: [
            {
              resource: {
                attributes: [
                  {
                    key: "service.name",
                    value: { stringValue: "dom-event-instrumentation" },
                  },
                  { key: "service.version", value: { stringValue: "1.0.0" } },
                ],
              },
              scopeLogs: [
                {
                  scope: {
                    name: "test-logger",
                    version: "1.0.0",
                  },
                  logRecords: [
                    {
                      timeUnixNano: getTimeNanos().toString(),
                      severityNumber: 9, // INFO
                      severityText: "INFO",
                      body: {
                        stringValue: "Test log message from OpenTelemetry IE11",
                      },
                      attributes: [
                        {
                          key: "test.type",
                          value: { stringValue: "log_test" },
                        },
                        {
                          key: "test.timestamp",
                          value: { stringValue: new Date().toISOString() },
                        },
                        {
                          key: "browser.userAgent",
                          value: { stringValue: navigator.userAgent },
                        },
                      ],
                    },
                  ],
                },
              ],
            },
          ],
        };

        sendToCollector(logCollectorUrl, logPayload, "Log");
      }

      function sendTestMetric() {
        var metricCollectorUrl =
          document.getElementById("metricCollectorUrl").value;
        updateCollectorStatus("í…ŒìŠ¤íŠ¸ ë©”íŠ¸ë¦­ì„ metric collectorë¡œ ì „ì†¡ ì¤‘...");

        var metricPayload = {
          resourceMetrics: [
            {
              resource: {
                attributes: [
                  {
                    key: "service.name",
                    value: { stringValue: "dom-event-instrumentation" },
                  },
                  { key: "service.version", value: { stringValue: "1.0.0" } },
                ],
              },
              scopeMetrics: [
                {
                  scope: {
                    name: "test-meter",
                    version: "1.0.0",
                  },
                  metrics: [
                    {
                      name: "test_counter",
                      description: "Test counter metric",
                      unit: "1",
                      sum: {
                        dataPoints: [
                          {
                            attributes: [
                              {
                                key: "test.type",
                                value: { stringValue: "metric_test" },
                              },
                            ],
                            startTimeUnixNano: (
                              getTimeNanos() - 60000000000
                            ).toString(),
                            timeUnixNano: getTimeNanos().toString(),
                            asInt: "42",
                          },
                        ],
                        aggregationTemporality: 2, // CUMULATIVE
                        isMonotonic: true,
                      },
                    },
                    {
                      name: "test_histogram",
                      description: "Test histogram metric",
                      unit: "ms",
                      histogram: {
                        dataPoints: [
                          {
                            attributes: [
                              {
                                key: "test.type",
                                value: { stringValue: "metric_test" },
                              },
                            ],
                            startTimeUnixNano: (
                              getTimeNanos() - 60000000000
                            ).toString(),
                            timeUnixNano: getTimeNanos().toString(),
                            count: "10",
                            sum: 1500.0,
                            bucketCounts: ["2", "3", "4", "1"],
                            explicitBounds: [10.0, 50.0, 100.0],
                          },
                        ],
                        aggregationTemporality: 2, // CUMULATIVE
                      },
                    },
                  ],
                },
              ],
            },
          ],
        };

        sendToCollector(metricCollectorUrl, metricPayload, "Metric");
      }

      function sendToCollector(url, payload, type) {
        var xhr = new XMLHttpRequest();
        xhr.open("POST", url, true);
        xhr.setRequestHeader("Content-Type", "application/json");

        xhr.onreadystatechange = function () {
          if (xhr.readyState === 4) {
            if (xhr.status >= 200 && xhr.status < 300) {
              updateCollectorStatus("âœ… " + type + " ì „ì†¡ ì„±ê³µ");
            } else {
              updateCollectorStatus(
                "âŒ " +
                  type +
                  " ì „ì†¡ ì‹¤íŒ¨: " +
                  xhr.status +
                  " " +
                  xhr.statusText
              );
            }
          }
        };

        xhr.onerror = function () {
          updateCollectorStatus("âŒ " + type + " ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ë¡œ ì „ì†¡ ì‹¤íŒ¨");
        };

        try {
          xhr.send(JSON.stringify(payload));
        } catch (error) {
          updateCollectorStatus("âŒ " + type + " ì „ì†¡ ì˜¤ë¥˜: " + error.message);
        }
      }

      function flushTraces() {
        if (pendingSpans.length > 0) {
          sendTracesToCollector(pendingSpans.slice());
          pendingSpans = [];
        } else {
          updateCollectorStatus("Flushí•  ëŒ€ê¸° ì¤‘ì¸ spanì´ ì—†ìŒ");
        }
      }

      function updateCollectorStatus(message) {
        document.getElementById("collectorStatus").textContent =
          new Date().toLocaleTimeString() + ": " + message;
      }

      function updateTraceStatus(message) {
        var statusElement = document.getElementById("collectorStatus");
        if (statusElement) {
          statusElement.textContent =
            new Date().toLocaleTimeString() + ": " + message;
        }
      }

      // Data Collection Functions
      function startDataCollection() {
        if (isDataCollectionActive) return;

        isDataCollectionActive = true;
        document.getElementById("collection-status").innerHTML =
          '<span class="status-display status-success">ìˆ˜ì§‘ ì¤‘</span>';
        document.getElementById("last-collection-time").textContent =
          new Date().toLocaleTimeString();

        addLogEntry("collected-data-log", "ğŸ“Š ë°ì´í„° ìˆ˜ì§‘ ì‹œì‘ë¨", "info");
      }

      function stopDataCollection() {
        if (!isDataCollectionActive) return;

        isDataCollectionActive = false;
        document.getElementById("collection-status").innerHTML =
          '<span class="status-display status-warning">ì¤‘ì§€ë¨</span>';

        addLogEntry("collected-data-log", "â¹ï¸ ë°ì´í„° ìˆ˜ì§‘ ì¤‘ì§€ë¨", "info");
      }

      function generateTestData() {
        var testSpan = {
          traceId: generateTraceId(),
          spanId: generateSpanId(),
          name: "test.operation",
          startTime: getTimeNanos(),
          endTime: getTimeNanos() + 1000000,
          attributes: {
            "test.type": "generated",
            "test.timestamp": new Date().toISOString(),
          },
        };

        collectedData.push(testSpan);
        document.getElementById("spans-collected").textContent =
          collectedData.length;

        addLogEntry(
          "collected-data-log",
          "âœ… í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„±ë¨: " + testSpan.name,
          "info"
        );
      }

      function clearCollectedData() {
        collectedData = [];
        document.getElementById("spans-collected").textContent = "0";
        document.getElementById("collected-data-log").textContent = "";
        addLogEntry("collected-data-log", "ğŸ—‘ï¸ ìˆ˜ì§‘ëœ ë°ì´í„° ì§€ì›Œì§", "info");
      }

      // Export Functions
      function testExportConnection() {
        var status = document.getElementById("export-connection-status");
        status.innerHTML =
          '<span class="status-display status-warning">í…ŒìŠ¤íŠ¸ ì¤‘...</span>';

        // Simulate connection test
        setTimeout(function () {
          status.innerHTML =
            '<span class="status-display status-success">ì—°ê²°ë¨</span>';
          addLogEntry(
            "export-log",
            "âœ… Export collector ì—°ê²° í…ŒìŠ¤íŠ¸ ì„±ê³µ",
            "success"
          );
        }, 1000);
      }

      function exportAllData() {
        var totalSpans = collectedData.length + eventHistory.length;
        document.getElementById("export-total-spans").textContent = totalSpans;

        if (totalSpans === 0) {
          addLogEntry("export-log", "âŒ ë‚´ë³´ë‚¼ ë°ì´í„°ê°€ ì—†ìŒ", "error");
          return;
        }

        exportSuccessCount += totalSpans;
        document.getElementById("export-success-count").textContent =
          exportSuccessCount;
        document.getElementById("export-last-time").textContent =
          new Date().toLocaleTimeString();

        addLogEntry(
          "export-log",
          "âœ… " + totalSpans + "ê°œ í•­ëª© ë‚´ë³´ë‚´ê¸° ì„±ê³µ",
          "success"
        );
      }

      function exportSelectedData() {
        addLogEntry(
          "export-log",
          "â„¹ï¸ ì„ íƒ ë°ì´í„° ë‚´ë³´ë‚´ê¸° ê¸°ëŠ¥ êµ¬í˜„ ì˜ˆì •",
          "info"
        );
      }

      // Event Handlers
      function handleAreaClick(event) {
        console.log("ì˜ì—­ í´ë¦­:", event);
      }

      function handleAreaDblClick(event) {
        console.log("ì˜ì—­ ë”ë¸”í´ë¦­:", event);
      }

      function handleAreaMouseOver(event) {
        console.log("ë§ˆìš°ìŠ¤ ì˜¤ë²„:", event);
      }

      function handleAreaMouseOut(event) {
        console.log("ë§ˆìš°ìŠ¤ ì•„ì›ƒ:", event);
      }

      function handleKeyDown(event) {
        console.log("í‚¤ ì…ë ¥:", event.key);
      }

      function submitForm() {
        alert("ë²„íŠ¼ìœ¼ë¡œ í¼ ì œì¶œë¨!");
      }

      function handleFormSubmit(event) {
        event.preventDefault();
        alert("í¼ ìš”ì†Œë¡œ ì œì¶œë¨!");
      }

      // DOM Event Instrumentation Implementation
      function createDOMEventInstrumentation(config) {
        var handlers = [];
        var eventHistory = [];
        var instrumentedElements = [];

        function getHighResolutionTime() {
          if (typeof performance !== "undefined" && performance.now) {
            return performance.now();
          }
          return Date.now();
        }

        function getElementSelector(element) {
          if (!element || element.nodeType !== 1) {
            return "unknown";
          }
          var tagName = element.tagName.toLowerCase();
          var id = element.id;
          var className = element.className;
          if (id) {
            return tagName + "#" + id;
          }
          if (className && typeof className === "string") {
            var classes = className.split(/\s+/).slice(0, 2).join(".");
            if (classes) {
              return tagName + "." + classes;
            }
          }
          return tagName;
        }

        function createEventData(event, phase) {
          var target = event.target;
          var timestamp = getHighResolutionTime();
          return {
            type: event.type,
            target: getElementSelector(target),
            timestamp: timestamp,
            phase: phase,
            bubbled: event.bubbles,
            cancelled: event.defaultPrevented,
            synthetic: !event.isTrusted,
          };
        }

        function processEvent(event, phase) {
          if (
            config.trackedEvents &&
            config.trackedEvents.indexOf(event.type) === -1
          ) {
            return;
          }

          var eventData = createEventData(event, phase);

          if (config.enableTiming) {
            eventData.duration = getHighResolutionTime() - eventData.timestamp;
          }

          eventHistory.push(eventData);

          if (eventHistory.length > (config.maxEventHistory || 1000)) {
            eventHistory.splice(
              0,
              eventHistory.length - (config.maxEventHistory || 1000)
            );
          }

          for (var i = 0; i < handlers.length; i++) {
            try {
              handlers[i](eventData);
            } catch (error) {
              console.error("ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì˜¤ë¥˜:", error);
            }
          }
        }

        return {
          addHandler: function (handler) {
            if (handlers.indexOf(handler) === -1) {
              handlers.push(handler);
            }
          },
          removeHandler: function (handler) {
            var index = handlers.indexOf(handler);
            if (index !== -1) {
              handlers.splice(index, 1);
            }
          },
          instrument: function (element) {
            if (instrumentedElements.indexOf(element) !== -1) {
              return;
            }

            var originalAddEventListener = element.addEventListener;
            if (originalAddEventListener) {
              element.addEventListener = function (type, listener, options) {
                var wrappedListener = function (event) {
                  processEvent(event, "bubbling");
                  if (typeof listener === "function") {
                    return listener.call(this, event);
                  }
                };
                return originalAddEventListener.call(
                  this,
                  type,
                  wrappedListener,
                  options
                );
              };
            }

            instrumentedElements.push(element);
          },
          getEventHistory: function () {
            return eventHistory.slice();
          },
          clearHistory: function () {
            eventHistory = [];
          },
          updateConfig: function (newConfig) {
            for (var key in newConfig) {
              if (newConfig.hasOwnProperty(key)) {
                config[key] = newConfig[key];
              }
            }
          },
          destroy: function () {
            handlers = [];
            eventHistory = [];
            instrumentedElements = [];
          },
        };
      }

      // Auto-flush traces periodically
      setInterval(function () {
        if (pendingSpans.length > 0 && isInstrumentationActive) {
          sendTracesToCollector(pendingSpans.slice());
          pendingSpans = [];
        }
      }, 5000);

      // Initialize
      window.onload = function () {
        addLogEntry(
          "eventLogArea",
          "ğŸš€ OpenTelemetry IE11 Complete Test Suite ì´ˆê¸°í™”ë¨",
          "info"
        );

        // Debug: Check if agent is loaded
        console.log("Agent check:", typeof OpenTelemetryIE11Agent);
        console.log("Window object:", window.OpenTelemetryIE11Agent);

        // Setup tab click handlers
        var tabs = document.querySelectorAll(".tab");
        console.log("Found tabs:", tabs.length);
        for (var i = 0; i < tabs.length; i++) {
          console.log("Setting up tab:", i, tabs[i].getAttribute("data-tab"));
          tabs[i].addEventListener("click", function () {
            var tabName = this.getAttribute("data-tab");
            console.log("Tab clicked:", tabName);
            showTab(tabName);
          });
        }

        // Run initial agent test
        setTimeout(function () {
          runAgentTests();
        }, 1000);
      };
    </script>
  </body>
</html>
